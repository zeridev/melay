# 1) CA private key
openssl genpkey -algorithm RSA -out ca.key.pem -pkeyopt rsa_keygen_bits:4096

# 2) CA self-signed certificate (valid e.g. 10 years)
openssl req -x509 -new -nodes -key ca.key.pem \
  -sha256 -days 3650 \
  -subj "/C=US/ST=State/L=City/O=MyFederationCA/CN=MyFederationRootCA" \
  -out ca.cert.pem

# 3) Server key
openssl genpkey -algorithm RSA -out server-a.key.pem -pkeyopt rsa_keygen_bits:2048

# 4) CSR (set CN to the server's canonical hostname used in federation)
openssl req -new -key server-a.key.pem \
  -subj "/C=US/ST=State/L=City/O=Example/CN=server-a.example" \
  -out server-a.csr.pem

# 5) Sign CSR to issue server cert (valid 2 years)
openssl x509 -req -in server-a.csr.pem -CA ca.cert.pem -CAkey ca.key.pem \
  -CAcreateserial -out server-a.cert.pem -days 730 -sha256

# 6) Combine private key + cert into PKCS12 keystore
openssl pkcs12 -export \
  -in server-a.cert.pem -inkey server-a.key.pem -certfile ca.cert.pem \
  -name server-a \
  -out server-a-keystore.p12 \
  -passout pass:changeit

# 7) Create a PKCS12 truststore and import CA cert
# (or use keytool to import into a JKS)
keytool -importcert -v -trustcacerts -file ca.cert.pem \
  -alias my-federation-ca \
  -keystore trusted-ca.p12 \
  -storetype PKCS12 \
  -storepass changeit \
  -noprompt

