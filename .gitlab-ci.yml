image: gradle:9.1-jdk21

stages:
  - test

test_server:
  stage: test
  variables:
    GRADLE_OPTS: "-Dorg.gradle.daemon=false"
  script:
    - gradle :server:assemble --no-daemon
    - gradle :server:test --no-daemon
    - gradle :server:jacocoTestReport --no-daemon
    - gradle :server:dependencyCheckAnalyze --no-daemon
    - gradle :server:sonar -Dsonar.branch.name=$CI_COMMIT_REF_NAME --no-daemon

  artifacts:
    when: always
    reports:
      junit:
        - server/build/test-results/test/*.xml
    paths:
      - server/build/reports/jacoco/test/
      - server/build/reports/dependency-check/
